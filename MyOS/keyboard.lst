     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_io_in8
     7 00000000                                 	EXTERN	_io_out8
     8 00000000                                 	EXTERN	_io_hlt
     9 00000000                                 	EXTERN	_task_kernal
    10 00000000                                 	EXTERN	_fifo_put
    11 00000000                                 	EXTERN	_task_run
    12 00000000                                 [FILE "keyboard.c"]
    13 00000000                                 	GLOBAL	_shift
    14                                          [SECTION .data]
    15 00000000                                 _shift:
    16 00000000 00                              	DB	0
    17 00000001                                 	GLOBAL	_ctrl
    18 00000001                                 _ctrl:
    19 00000001 00                              	DB	0
    20 00000002 00 00                           	ALIGNB	4
    21 00000004                                 _key_leds:
    22 00000004 FFFFFFFF                        	DD	-1
    23                                          [SECTION .text]
    24 00000000                                 	GLOBAL	_wait_KBC_sendready
    25 00000000                                 _wait_KBC_sendready:
    26 00000000 55                              	PUSH	EBP
    27 00000001 89 E5                           	MOV	EBP,ESP
    28 00000003                                 L6:
    29 00000003 6A 64                           	PUSH	100
    30 00000005 E8 [00000000]                   	CALL	_io_in8
    31 0000000A 5A                              	POP	EDX
    32 0000000B 83 E0 02                        	AND	EAX,2
    33 0000000E 75 F3                           	JNE	L6
    34 00000010 C9                              	LEAVE
    35 00000011 C3                              	RET
    36 00000012                                 	GLOBAL	_set_kb_led
    37 00000012                                 _set_kb_led:
    38 00000012 55                              	PUSH	EBP
    39 00000013 89 E5                           	MOV	EBP,ESP
    40 00000015                                 L8:
    41 00000015 C6 05 [000000B0] 00             	MOV	BYTE [_sendback_ack],0
    42 0000001C E8 FFFFFFDF                     	CALL	_wait_KBC_sendready
    43 00000021 68 000000ED                     	PUSH	237
    44 00000026 6A 60                           	PUSH	96
    45 00000028 E8 [00000000]                   	CALL	_io_out8
    46 0000002D 58                              	POP	EAX
    47 0000002E 5A                              	POP	EDX
    48 0000002F 80 3D [000000B0] 00             	CMP	BYTE [_sendback_ack],0
    49 00000036 74 48                           	JE	L12
    50 00000038                                 L20:
    51 00000038 80 3D [000000B0] FF             	CMP	BYTE [_sendback_ack],-1
    52 0000003F 74 D4                           	JE	L8
    53 00000041 C6 05 [000000B0] 00             	MOV	BYTE [_sendback_ack],0
    54 00000048 E8 FFFFFFB3                     	CALL	_wait_KBC_sendready
    55 0000004D FF 35 [00000004]                	PUSH	DWORD [_key_leds]
    56 00000053 6A 60                           	PUSH	96
    57 00000055 E8 [00000000]                   	CALL	_io_out8
    58 0000005A 59                              	POP	ECX
    59 0000005B 58                              	POP	EAX
    60 0000005C 80 3D [000000B0] 00             	CMP	BYTE [_sendback_ack],0
    61 00000063 74 0B                           	JE	L17
    62 00000065                                 L22:
    63 00000065 80 3D [000000B0] FF             	CMP	BYTE [_sendback_ack],-1
    64 0000006C 74 A7                           	JE	L8
    65 0000006E C9                              	LEAVE
    66 0000006F C3                              	RET
    67 00000070                                 L17:
    68 00000070 E8 [00000000]                   	CALL	_io_hlt
    69 00000075 80 3D [000000B0] 00             	CMP	BYTE [_sendback_ack],0
    70 0000007C 74 F2                           	JE	L17
    71 0000007E EB E5                           	JMP	L22
    72 00000080                                 L12:
    73 00000080 E8 [00000000]                   	CALL	_io_hlt
    74 00000085 80 3D [000000B0] 00             	CMP	BYTE [_sendback_ack],0
    75 0000008C 74 F2                           	JE	L12
    76 0000008E EB A8                           	JMP	L20
    77 00000090                                 	GLOBAL	_init_keyboard
    78 00000090                                 _init_keyboard:
    79 00000090 55                              	PUSH	EBP
    80 00000091 89 E5                           	MOV	EBP,ESP
    81 00000093 E8 FFFFFF68                     	CALL	_wait_KBC_sendready
    82 00000098 6A 60                           	PUSH	96
    83 0000009A 6A 64                           	PUSH	100
    84 0000009C E8 [00000000]                   	CALL	_io_out8
    85 000000A1 E8 FFFFFF5A                     	CALL	_wait_KBC_sendready
    86 000000A6 6A 47                           	PUSH	71
    87 000000A8 6A 60                           	PUSH	96
    88 000000AA E8 [00000000]                   	CALL	_io_out8
    89 000000AF 83 C4 10                        	ADD	ESP,16
    90 000000B2 83 3D [00000004] FF             	CMP	DWORD [_key_leds],-1
    91 000000B9 74 02                           	JE	L25
    92 000000BB                                 L23:
    93 000000BB C9                              	LEAVE
    94 000000BC C3                              	RET
    95 000000BD                                 L25:
    96 000000BD A0 00000FF1                     	MOV	AL,BYTE [4081]
    97 000000C2 C0 F8 04                        	SAR	AL,4
    98 000000C5 83 E0 07                        	AND	EAX,7
    99 000000C8 A3 [00000004]                   	MOV	DWORD [_key_leds],EAX
   100 000000CD EB EC                           	JMP	L23
   101 000000CF                                 	GLOBAL	_inthandler21
   102 000000CF                                 _inthandler21:
   103 000000CF 55                              	PUSH	EBP
   104 000000D0 89 E5                           	MOV	EBP,ESP
   105 000000D2 6A 61                           	PUSH	97
   106 000000D4 6A 20                           	PUSH	32
   107 000000D6 E8 [00000000]                   	CALL	_io_out8
   108 000000DB 6A 60                           	PUSH	96
   109 000000DD E8 [00000000]                   	CALL	_io_in8
   110 000000E2 83 C4 0C                        	ADD	ESP,12
   111 000000E5 3C FA                           	CMP	AL,-6
   112 000000E7 74 73                           	JE	L35
   113 000000E9 C6 05 [000000B0] FF             	MOV	BYTE [_sendback_ack],-1
   114 000000F0 3C 1D                           	CMP	AL,29
   115 000000F2 74 5F                           	JE	L36
   116 000000F4                                 L28:
   117 000000F4 3C 9D                           	CMP	AL,-99
   118 000000F6 74 52                           	JE	L37
   119 000000F8                                 L29:
   120 000000F8 3C 2A                           	CMP	AL,42
   121 000000FA 74 45                           	JE	L31
   122 000000FC 3C 36                           	CMP	AL,54
   123 000000FE 74 41                           	JE	L31
   124 00000100                                 L30:
   125 00000100 3C AA                           	CMP	AL,-86
   126 00000102 74 34                           	JE	L33
   127 00000104 3C B6                           	CMP	AL,-74
   128 00000106 74 30                           	JE	L33
   129 00000108                                 L32:
   130 00000108 3C BA                           	CMP	AL,-70
   131 0000010A 74 23                           	JE	L38
   132 0000010C                                 L34:
   133 0000010C 0F B6 C0                        	MOVZX	EAX,AL
   134 0000010F 50                              	PUSH	EAX
   135 00000110 A1 [00000000]                   	MOV	EAX,DWORD [_task_kernal]
   136 00000115 83 C0 10                        	ADD	EAX,16
   137 00000118 50                              	PUSH	EAX
   138 00000119 E8 [00000000]                   	CALL	_fifo_put
   139 0000011E 6A 00                           	PUSH	0
   140 00000120 6A FF                           	PUSH	-1
   141 00000122 FF 35 [00000000]                	PUSH	DWORD [_task_kernal]
   142 00000128 E8 [00000000]                   	CALL	_task_run
   143 0000012D                                 L26:
   144 0000012D C9                              	LEAVE
   145 0000012E C3                              	RET
   146 0000012F                                 L38:
   147 0000012F 83 35 [00000004] 04             	XOR	DWORD [_key_leds],4
   148 00000136 EB D4                           	JMP	L34
   149 00000138                                 L33:
   150 00000138 C6 05 [00000000] 00             	MOV	BYTE [_shift],0
   151 0000013F EB C7                           	JMP	L32
   152 00000141                                 L31:
   153 00000141 C6 05 [00000000] 01             	MOV	BYTE [_shift],1
   154 00000148 EB B6                           	JMP	L30
   155 0000014A                                 L37:
   156 0000014A C6 05 [00000001] 00             	MOV	BYTE [_ctrl],0
   157 00000151 EB A5                           	JMP	L29
   158 00000153                                 L36:
   159 00000153 C6 05 [00000001] 01             	MOV	BYTE [_ctrl],1
   160 0000015A EB 98                           	JMP	L28
   161 0000015C                                 L35:
   162 0000015C C6 05 [000000B0] 01             	MOV	BYTE [_sendback_ack],1
   163 00000163 EB C8                           	JMP	L26
   164                                          [SECTION .data]
   165 00000008                                 _keytable1.0:
   166 00000008 00                              	DB	0
   167 00000009 00                              	DB	0
   168 0000000A 31                              	DB	49
   169 0000000B 32                              	DB	50
   170 0000000C 33                              	DB	51
   171 0000000D 34                              	DB	52
   172 0000000E 35                              	DB	53
   173 0000000F 36                              	DB	54
   174 00000010 37                              	DB	55
   175 00000011 38                              	DB	56
   176 00000012 39                              	DB	57
   177 00000013 30                              	DB	48
   178 00000014 2D                              	DB	45
   179 00000015 3D                              	DB	61
   180 00000016 08                              	DB	8
   181 00000017 00                              	DB	0
   182 00000018 71                              	DB	113
   183 00000019 77                              	DB	119
   184 0000001A 65                              	DB	101
   185 0000001B 72                              	DB	114
   186 0000001C 74                              	DB	116
   187 0000001D 79                              	DB	121
   188 0000001E 75                              	DB	117
   189 0000001F 69                              	DB	105
   190 00000020 6F                              	DB	111
   191 00000021 70                              	DB	112
   192 00000022 5B                              	DB	91
   193 00000023 5D                              	DB	93
   194 00000024 0A                              	DB	10
   195 00000025 00                              	DB	0
   196 00000026 61                              	DB	97
   197 00000027 73                              	DB	115
   198 00000028 64                              	DB	100
   199 00000029 66                              	DB	102
   200 0000002A 67                              	DB	103
   201 0000002B 68                              	DB	104
   202 0000002C 6A                              	DB	106
   203 0000002D 6B                              	DB	107
   204 0000002E 6C                              	DB	108
   205 0000002F 3B                              	DB	59
   206 00000030 27                              	DB	39
   207 00000031 60                              	DB	96
   208 00000032 00                              	DB	0
   209 00000033 5C                              	DB	92
   210 00000034 7A                              	DB	122
   211 00000035 78                              	DB	120
   212 00000036 63                              	DB	99
   213 00000037 76                              	DB	118
   214 00000038 62                              	DB	98
   215 00000039 6E                              	DB	110
   216 0000003A 6D                              	DB	109
   217 0000003B 2C                              	DB	44
   218 0000003C 2E                              	DB	46
   219 0000003D 2F                              	DB	47
   220 0000003E 00                              	DB	0
   221 0000003F 2A                              	DB	42
   222 00000040 00                              	DB	0
   223 00000041 20                              	DB	32
   224 00000042 00                              	DB	0
   225 00000043 00                              	DB	0
   226 00000044 00                              	DB	0
   227 00000045 00                              	DB	0
   228 00000046 00                              	DB	0
   229 00000047 00                              	DB	0
   230 00000048 00                              	DB	0
   231 00000049 00                              	DB	0
   232 0000004A 00                              	DB	0
   233 0000004B 00                              	DB	0
   234 0000004C 00                              	DB	0
   235 0000004D 00                              	DB	0
   236 0000004E 00                              	DB	0
   237 0000004F 37                              	DB	55
   238 00000050 38                              	DB	56
   239 00000051 39                              	DB	57
   240 00000052 2D                              	DB	45
   241 00000053 34                              	DB	52
   242 00000054 35                              	DB	53
   243 00000055 36                              	DB	54
   244 00000056 2B                              	DB	43
   245 00000057 31                              	DB	49
   246 00000058 32                              	DB	50
   247 00000059 33                              	DB	51
   248 0000005A 30                              	DB	48
   249 0000005B 2E                              	DB	46
   250 0000005C                                 _keytable2.1:
   251 0000005C 00                              	DB	0
   252 0000005D 00                              	DB	0
   253 0000005E 21                              	DB	33
   254 0000005F 40                              	DB	64
   255 00000060 23                              	DB	35
   256 00000061 24                              	DB	36
   257 00000062 25                              	DB	37
   258 00000063 5E                              	DB	94
   259 00000064 26                              	DB	38
   260 00000065 2A                              	DB	42
   261 00000066 28                              	DB	40
   262 00000067 29                              	DB	41
   263 00000068 5F                              	DB	95
   264 00000069 2B                              	DB	43
   265 0000006A 08                              	DB	8
   266 0000006B 00                              	DB	0
   267 0000006C 51                              	DB	81
   268 0000006D 57                              	DB	87
   269 0000006E 45                              	DB	69
   270 0000006F 52                              	DB	82
   271 00000070 54                              	DB	84
   272 00000071 59                              	DB	89
   273 00000072 55                              	DB	85
   274 00000073 49                              	DB	73
   275 00000074 4F                              	DB	79
   276 00000075 50                              	DB	80
   277 00000076 7B                              	DB	123
   278 00000077 7D                              	DB	125
   279 00000078 0A                              	DB	10
   280 00000079 00                              	DB	0
   281 0000007A 41                              	DB	65
   282 0000007B 53                              	DB	83
   283 0000007C 44                              	DB	68
   284 0000007D 46                              	DB	70
   285 0000007E 47                              	DB	71
   286 0000007F 48                              	DB	72
   287 00000080 4A                              	DB	74
   288 00000081 4B                              	DB	75
   289 00000082 4C                              	DB	76
   290 00000083 3A                              	DB	58
   291 00000084 22                              	DB	34
   292 00000085 7E                              	DB	126
   293 00000086 00                              	DB	0
   294 00000087 7C                              	DB	124
   295 00000088 5A                              	DB	90
   296 00000089 58                              	DB	88
   297 0000008A 43                              	DB	67
   298 0000008B 56                              	DB	86
   299 0000008C 42                              	DB	66
   300 0000008D 4E                              	DB	78
   301 0000008E 4D                              	DB	77
   302 0000008F 3C                              	DB	60
   303 00000090 3E                              	DB	62
   304 00000091 3F                              	DB	63
   305 00000092 00                              	DB	0
   306 00000093 2A                              	DB	42
   307 00000094 00                              	DB	0
   308 00000095 20                              	DB	32
   309 00000096 00                              	DB	0
   310 00000097 00                              	DB	0
   311 00000098 00                              	DB	0
   312 00000099 00                              	DB	0
   313 0000009A 00                              	DB	0
   314 0000009B 00                              	DB	0
   315 0000009C 00                              	DB	0
   316 0000009D 00                              	DB	0
   317 0000009E 00                              	DB	0
   318 0000009F 00                              	DB	0
   319 000000A0 00                              	DB	0
   320 000000A1 00                              	DB	0
   321 000000A2 00                              	DB	0
   322 000000A3 37                              	DB	55
   323 000000A4 38                              	DB	56
   324 000000A5 39                              	DB	57
   325 000000A6 2D                              	DB	45
   326 000000A7 34                              	DB	52
   327 000000A8 35                              	DB	53
   328 000000A9 36                              	DB	54
   329 000000AA 2B                              	DB	43
   330 000000AB 31                              	DB	49
   331 000000AC 32                              	DB	50
   332 000000AD 33                              	DB	51
   333 000000AE 30                              	DB	48
   334 000000AF 2E                              	DB	46
   335                                          [SECTION .text]
   336 00000165                                 	GLOBAL	_key_to_char
   337 00000165                                 _key_to_char:
   338 00000165 55                              	PUSH	EBP
   339 00000166 31 D2                           	XOR	EDX,EDX
   340 00000168 89 E5                           	MOV	EBP,ESP
   341 0000016A 8A 45 08                        	MOV	AL,BYTE [8+EBP]
   342 0000016D 3C 53                           	CMP	AL,83
   343 0000016F 77 2F                           	JA	L39
   344 00000171 80 3D [00000000] 00             	CMP	BYTE [_shift],0
   345 00000178 74 2A                           	JE	L41
   346 0000017A 0F B6 C0                        	MOVZX	EAX,AL
   347 0000017D 8A 90 [0000005C]                	MOV	DL,BYTE [_keytable2.1+EAX]
   348 00000183                                 L42:
   349 00000183 F6 05 [00000004] 04             	TEST	BYTE [_key_leds],4
   350 0000018A 74 11                           	JE	L43
   351 0000018C 8D 42 9F                        	LEA	EAX,DWORD [-97+EDX]
   352 0000018F 3C 19                           	CMP	AL,25
   353 00000191 76 07                           	JBE	L45
   354 00000193 8D 42 BF                        	LEA	EAX,DWORD [-65+EDX]
   355 00000196 3C 19                           	CMP	AL,25
   356 00000198 77 03                           	JA	L43
   357 0000019A                                 L45:
   358 0000019A 83 F2 20                        	XOR	EDX,32
   359 0000019D                                 L43:
   360 0000019D 0F BE D2                        	MOVSX	EDX,DL
   361 000001A0                                 L39:
   362 000001A0 89 D0                           	MOV	EAX,EDX
   363 000001A2 5D                              	POP	EBP
   364 000001A3 C3                              	RET
   365 000001A4                                 L41:
   366 000001A4 0F B6 C0                        	MOVZX	EAX,AL
   367 000001A7 8A 90 [00000008]                	MOV	DL,BYTE [_keytable1.0+EAX]
   368 000001AD EB D4                           	JMP	L42
   369                                          [SECTION .data]
   370 000000B0                                 _sendback_ack:
   371 000000B0 00                              	RESB	1
