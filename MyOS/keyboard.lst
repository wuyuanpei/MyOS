     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_io_in8
     7 00000000                                 	EXTERN	_io_out8
     8 00000000                                 	EXTERN	_key_leds
     9 00000000                                 	EXTERN	_io_hlt
    10 00000000                                 	EXTERN	_task_kernal
    11 00000000                                 	EXTERN	_fifo_put
    12 00000000                                 	EXTERN	_task_run
    13 00000000                                 	EXTERN	_shift
    14 00000000                                 [FILE "keyboard.c"]
    15                                          [SECTION .data]
    16 00000000                                 _shift:
    17 00000000 00                              	DB	0
    18 00000001 00 00 00                        	ALIGNB	4
    19 00000004                                 _key_leds:
    20 00000004 FFFFFFFF                        	DD	-1
    21                                          [SECTION .text]
    22 00000000                                 	GLOBAL	_wait_KBC_sendready
    23 00000000                                 _wait_KBC_sendready:
    24 00000000 55                              	PUSH	EBP
    25 00000001 89 E5                           	MOV	EBP,ESP
    26 00000003                                 L6:
    27 00000003 6A 64                           	PUSH	100
    28 00000005 E8 [00000000]                   	CALL	_io_in8
    29 0000000A 5A                              	POP	EDX
    30 0000000B 83 E0 02                        	AND	EAX,2
    31 0000000E 75 F3                           	JNE	L6
    32 00000010 C9                              	LEAVE
    33 00000011 C3                              	RET
    34 00000012                                 	GLOBAL	_set_kb_led
    35 00000012                                 _set_kb_led:
    36 00000012 55                              	PUSH	EBP
    37 00000013 89 E5                           	MOV	EBP,ESP
    38 00000015                                 L8:
    39 00000015 C6 05 [000000B0] 00             	MOV	BYTE [_sendback_ack],0
    40 0000001C E8 FFFFFFDF                     	CALL	_wait_KBC_sendready
    41 00000021 68 000000ED                     	PUSH	237
    42 00000026 6A 60                           	PUSH	96
    43 00000028 E8 [00000000]                   	CALL	_io_out8
    44 0000002D 58                              	POP	EAX
    45 0000002E 5A                              	POP	EDX
    46 0000002F 80 3D [000000B0] 00             	CMP	BYTE [_sendback_ack],0
    47 00000036 74 48                           	JE	L12
    48 00000038                                 L20:
    49 00000038 80 3D [000000B0] FF             	CMP	BYTE [_sendback_ack],-1
    50 0000003F 74 D4                           	JE	L8
    51 00000041 C6 05 [000000B0] 00             	MOV	BYTE [_sendback_ack],0
    52 00000048 E8 FFFFFFB3                     	CALL	_wait_KBC_sendready
    53 0000004D FF 35 [00000004]                	PUSH	DWORD [_key_leds]
    54 00000053 6A 60                           	PUSH	96
    55 00000055 E8 [00000000]                   	CALL	_io_out8
    56 0000005A 59                              	POP	ECX
    57 0000005B 58                              	POP	EAX
    58 0000005C 80 3D [000000B0] 00             	CMP	BYTE [_sendback_ack],0
    59 00000063 74 0B                           	JE	L17
    60 00000065                                 L22:
    61 00000065 80 3D [000000B0] FF             	CMP	BYTE [_sendback_ack],-1
    62 0000006C 74 A7                           	JE	L8
    63 0000006E C9                              	LEAVE
    64 0000006F C3                              	RET
    65 00000070                                 L17:
    66 00000070 E8 [00000000]                   	CALL	_io_hlt
    67 00000075 80 3D [000000B0] 00             	CMP	BYTE [_sendback_ack],0
    68 0000007C 74 F2                           	JE	L17
    69 0000007E EB E5                           	JMP	L22
    70 00000080                                 L12:
    71 00000080 E8 [00000000]                   	CALL	_io_hlt
    72 00000085 80 3D [000000B0] 00             	CMP	BYTE [_sendback_ack],0
    73 0000008C 74 F2                           	JE	L12
    74 0000008E EB A8                           	JMP	L20
    75 00000090                                 	GLOBAL	_init_keyboard
    76 00000090                                 _init_keyboard:
    77 00000090 55                              	PUSH	EBP
    78 00000091 89 E5                           	MOV	EBP,ESP
    79 00000093 E8 FFFFFF68                     	CALL	_wait_KBC_sendready
    80 00000098 6A 60                           	PUSH	96
    81 0000009A 6A 64                           	PUSH	100
    82 0000009C E8 [00000000]                   	CALL	_io_out8
    83 000000A1 E8 FFFFFF5A                     	CALL	_wait_KBC_sendready
    84 000000A6 6A 47                           	PUSH	71
    85 000000A8 6A 60                           	PUSH	96
    86 000000AA E8 [00000000]                   	CALL	_io_out8
    87 000000AF 83 C4 10                        	ADD	ESP,16
    88 000000B2 83 3D [00000004] FF             	CMP	DWORD [_key_leds],-1
    89 000000B9 74 02                           	JE	L25
    90 000000BB                                 L23:
    91 000000BB C9                              	LEAVE
    92 000000BC C3                              	RET
    93 000000BD                                 L25:
    94 000000BD A0 00000FF1                     	MOV	AL,BYTE [4081]
    95 000000C2 C0 F8 04                        	SAR	AL,4
    96 000000C5 83 E0 07                        	AND	EAX,7
    97 000000C8 A3 [00000004]                   	MOV	DWORD [_key_leds],EAX
    98 000000CD EB EC                           	JMP	L23
    99 000000CF                                 	GLOBAL	_inthandler21
   100 000000CF                                 _inthandler21:
   101 000000CF 55                              	PUSH	EBP
   102 000000D0 89 E5                           	MOV	EBP,ESP
   103 000000D2 6A 61                           	PUSH	97
   104 000000D4 6A 20                           	PUSH	32
   105 000000D6 E8 [00000000]                   	CALL	_io_out8
   106 000000DB 6A 60                           	PUSH	96
   107 000000DD E8 [00000000]                   	CALL	_io_in8
   108 000000E2 83 C4 0C                        	ADD	ESP,12
   109 000000E5 3C FA                           	CMP	AL,-6
   110 000000E7 74 59                           	JE	L33
   111 000000E9 C6 05 [000000B0] FF             	MOV	BYTE [_sendback_ack],-1
   112 000000F0 3C 2A                           	CMP	AL,42
   113 000000F2 74 45                           	JE	L29
   114 000000F4 3C 36                           	CMP	AL,54
   115 000000F6 74 41                           	JE	L29
   116 000000F8                                 L28:
   117 000000F8 3C AA                           	CMP	AL,-86
   118 000000FA 74 34                           	JE	L31
   119 000000FC 3C B6                           	CMP	AL,-74
   120 000000FE 74 30                           	JE	L31
   121 00000100                                 L30:
   122 00000100 3C BA                           	CMP	AL,-70
   123 00000102 74 23                           	JE	L34
   124 00000104                                 L32:
   125 00000104 0F B6 C0                        	MOVZX	EAX,AL
   126 00000107 50                              	PUSH	EAX
   127 00000108 A1 [00000000]                   	MOV	EAX,DWORD [_task_kernal]
   128 0000010D 83 C0 10                        	ADD	EAX,16
   129 00000110 50                              	PUSH	EAX
   130 00000111 E8 [00000000]                   	CALL	_fifo_put
   131 00000116 6A 00                           	PUSH	0
   132 00000118 6A FF                           	PUSH	-1
   133 0000011A FF 35 [00000000]                	PUSH	DWORD [_task_kernal]
   134 00000120 E8 [00000000]                   	CALL	_task_run
   135 00000125                                 L26:
   136 00000125 C9                              	LEAVE
   137 00000126 C3                              	RET
   138 00000127                                 L34:
   139 00000127 83 35 [00000004] 04             	XOR	DWORD [_key_leds],4
   140 0000012E EB D4                           	JMP	L32
   141 00000130                                 L31:
   142 00000130 C6 05 [00000000] 00             	MOV	BYTE [_shift],0
   143 00000137 EB C7                           	JMP	L30
   144 00000139                                 L29:
   145 00000139 C6 05 [00000000] 01             	MOV	BYTE [_shift],1
   146 00000140 EB B6                           	JMP	L28
   147 00000142                                 L33:
   148 00000142 C6 05 [000000B0] 01             	MOV	BYTE [_sendback_ack],1
   149 00000149 EB DA                           	JMP	L26
   150                                          [SECTION .data]
   151 00000008                                 _keytable1.0:
   152 00000008 00                              	DB	0
   153 00000009 00                              	DB	0
   154 0000000A 31                              	DB	49
   155 0000000B 32                              	DB	50
   156 0000000C 33                              	DB	51
   157 0000000D 34                              	DB	52
   158 0000000E 35                              	DB	53
   159 0000000F 36                              	DB	54
   160 00000010 37                              	DB	55
   161 00000011 38                              	DB	56
   162 00000012 39                              	DB	57
   163 00000013 30                              	DB	48
   164 00000014 2D                              	DB	45
   165 00000015 3D                              	DB	61
   166 00000016 08                              	DB	8
   167 00000017 00                              	DB	0
   168 00000018 71                              	DB	113
   169 00000019 77                              	DB	119
   170 0000001A 65                              	DB	101
   171 0000001B 72                              	DB	114
   172 0000001C 74                              	DB	116
   173 0000001D 79                              	DB	121
   174 0000001E 75                              	DB	117
   175 0000001F 69                              	DB	105
   176 00000020 6F                              	DB	111
   177 00000021 70                              	DB	112
   178 00000022 5B                              	DB	91
   179 00000023 5D                              	DB	93
   180 00000024 0A                              	DB	10
   181 00000025 00                              	DB	0
   182 00000026 61                              	DB	97
   183 00000027 73                              	DB	115
   184 00000028 64                              	DB	100
   185 00000029 66                              	DB	102
   186 0000002A 67                              	DB	103
   187 0000002B 68                              	DB	104
   188 0000002C 6A                              	DB	106
   189 0000002D 6B                              	DB	107
   190 0000002E 6C                              	DB	108
   191 0000002F 3B                              	DB	59
   192 00000030 27                              	DB	39
   193 00000031 60                              	DB	96
   194 00000032 00                              	DB	0
   195 00000033 5C                              	DB	92
   196 00000034 7A                              	DB	122
   197 00000035 78                              	DB	120
   198 00000036 63                              	DB	99
   199 00000037 76                              	DB	118
   200 00000038 62                              	DB	98
   201 00000039 6E                              	DB	110
   202 0000003A 6D                              	DB	109
   203 0000003B 2C                              	DB	44
   204 0000003C 2E                              	DB	46
   205 0000003D 2F                              	DB	47
   206 0000003E 00                              	DB	0
   207 0000003F 2A                              	DB	42
   208 00000040 00                              	DB	0
   209 00000041 20                              	DB	32
   210 00000042 00                              	DB	0
   211 00000043 00                              	DB	0
   212 00000044 00                              	DB	0
   213 00000045 00                              	DB	0
   214 00000046 00                              	DB	0
   215 00000047 00                              	DB	0
   216 00000048 00                              	DB	0
   217 00000049 00                              	DB	0
   218 0000004A 00                              	DB	0
   219 0000004B 00                              	DB	0
   220 0000004C 00                              	DB	0
   221 0000004D 00                              	DB	0
   222 0000004E 00                              	DB	0
   223 0000004F 37                              	DB	55
   224 00000050 38                              	DB	56
   225 00000051 39                              	DB	57
   226 00000052 2D                              	DB	45
   227 00000053 34                              	DB	52
   228 00000054 35                              	DB	53
   229 00000055 36                              	DB	54
   230 00000056 2B                              	DB	43
   231 00000057 31                              	DB	49
   232 00000058 32                              	DB	50
   233 00000059 33                              	DB	51
   234 0000005A 30                              	DB	48
   235 0000005B 2E                              	DB	46
   236 0000005C                                 _keytable2.1:
   237 0000005C 00                              	DB	0
   238 0000005D 00                              	DB	0
   239 0000005E 21                              	DB	33
   240 0000005F 40                              	DB	64
   241 00000060 23                              	DB	35
   242 00000061 24                              	DB	36
   243 00000062 25                              	DB	37
   244 00000063 5E                              	DB	94
   245 00000064 26                              	DB	38
   246 00000065 2A                              	DB	42
   247 00000066 28                              	DB	40
   248 00000067 29                              	DB	41
   249 00000068 5F                              	DB	95
   250 00000069 2B                              	DB	43
   251 0000006A 08                              	DB	8
   252 0000006B 00                              	DB	0
   253 0000006C 51                              	DB	81
   254 0000006D 57                              	DB	87
   255 0000006E 45                              	DB	69
   256 0000006F 52                              	DB	82
   257 00000070 54                              	DB	84
   258 00000071 59                              	DB	89
   259 00000072 55                              	DB	85
   260 00000073 49                              	DB	73
   261 00000074 4F                              	DB	79
   262 00000075 50                              	DB	80
   263 00000076 7B                              	DB	123
   264 00000077 7D                              	DB	125
   265 00000078 0A                              	DB	10
   266 00000079 00                              	DB	0
   267 0000007A 41                              	DB	65
   268 0000007B 53                              	DB	83
   269 0000007C 44                              	DB	68
   270 0000007D 46                              	DB	70
   271 0000007E 47                              	DB	71
   272 0000007F 48                              	DB	72
   273 00000080 4A                              	DB	74
   274 00000081 4B                              	DB	75
   275 00000082 4C                              	DB	76
   276 00000083 3A                              	DB	58
   277 00000084 22                              	DB	34
   278 00000085 7E                              	DB	126
   279 00000086 00                              	DB	0
   280 00000087 7C                              	DB	124
   281 00000088 5A                              	DB	90
   282 00000089 58                              	DB	88
   283 0000008A 43                              	DB	67
   284 0000008B 56                              	DB	86
   285 0000008C 42                              	DB	66
   286 0000008D 4E                              	DB	78
   287 0000008E 4D                              	DB	77
   288 0000008F 3C                              	DB	60
   289 00000090 3E                              	DB	62
   290 00000091 3F                              	DB	63
   291 00000092 00                              	DB	0
   292 00000093 2A                              	DB	42
   293 00000094 00                              	DB	0
   294 00000095 20                              	DB	32
   295 00000096 00                              	DB	0
   296 00000097 00                              	DB	0
   297 00000098 00                              	DB	0
   298 00000099 00                              	DB	0
   299 0000009A 00                              	DB	0
   300 0000009B 00                              	DB	0
   301 0000009C 00                              	DB	0
   302 0000009D 00                              	DB	0
   303 0000009E 00                              	DB	0
   304 0000009F 00                              	DB	0
   305 000000A0 00                              	DB	0
   306 000000A1 00                              	DB	0
   307 000000A2 00                              	DB	0
   308 000000A3 37                              	DB	55
   309 000000A4 38                              	DB	56
   310 000000A5 39                              	DB	57
   311 000000A6 2D                              	DB	45
   312 000000A7 34                              	DB	52
   313 000000A8 35                              	DB	53
   314 000000A9 36                              	DB	54
   315 000000AA 2B                              	DB	43
   316 000000AB 31                              	DB	49
   317 000000AC 32                              	DB	50
   318 000000AD 33                              	DB	51
   319 000000AE 30                              	DB	48
   320 000000AF 2E                              	DB	46
   321                                          [SECTION .text]
   322 0000014B                                 	GLOBAL	_key_to_char
   323 0000014B                                 _key_to_char:
   324 0000014B 55                              	PUSH	EBP
   325 0000014C 31 D2                           	XOR	EDX,EDX
   326 0000014E 89 E5                           	MOV	EBP,ESP
   327 00000150 8A 45 08                        	MOV	AL,BYTE [8+EBP]
   328 00000153 3C 53                           	CMP	AL,83
   329 00000155 77 2F                           	JA	L35
   330 00000157 80 3D [00000000] 00             	CMP	BYTE [_shift],0
   331 0000015E 74 2A                           	JE	L37
   332 00000160 0F B6 C0                        	MOVZX	EAX,AL
   333 00000163 8A 90 [0000005C]                	MOV	DL,BYTE [_keytable2.1+EAX]
   334 00000169                                 L38:
   335 00000169 F6 05 [00000004] 04             	TEST	BYTE [_key_leds],4
   336 00000170 74 11                           	JE	L39
   337 00000172 8D 42 9F                        	LEA	EAX,DWORD [-97+EDX]
   338 00000175 3C 19                           	CMP	AL,25
   339 00000177 76 07                           	JBE	L41
   340 00000179 8D 42 BF                        	LEA	EAX,DWORD [-65+EDX]
   341 0000017C 3C 19                           	CMP	AL,25
   342 0000017E 77 03                           	JA	L39
   343 00000180                                 L41:
   344 00000180 83 F2 20                        	XOR	EDX,32
   345 00000183                                 L39:
   346 00000183 0F BE D2                        	MOVSX	EDX,DL
   347 00000186                                 L35:
   348 00000186 89 D0                           	MOV	EAX,EDX
   349 00000188 5D                              	POP	EBP
   350 00000189 C3                              	RET
   351 0000018A                                 L37:
   352 0000018A 0F B6 C0                        	MOVZX	EAX,AL
   353 0000018D 8A 90 [00000008]                	MOV	DL,BYTE [_keytable1.0+EAX]
   354 00000193 EB D4                           	JMP	L38
   355                                          [SECTION .data]
   356 000000B0                                 _sendback_ack:
   357 000000B0 00                              	RESB	1
